---
// src/components/ProjectCard.astro
import { useTranslations, type Language } from "../../utils/i18n";
import { Icon } from "astro-icon/components";
import PDFButton from "./PDFButton.astro";
import Link from "./Link.astro";

interface Props {
  project: any;
  animationDelay: number;
  lang: Language;
}

const { project, animationDelay, lang } = Astro.props;
const t = useTranslations(lang);

const sectionLabel =
  "text-xs font-bold uppercase tracking-wider text-light-text dark:text-dark-text mb-3 flex items-center gap-2";

const conceptBadge =
  "text-xs px-3 py-1.5 rounded-full bg-accent-100 dark:bg-accent-900/30 text-accent-700 dark:text-accent-300 border border-accent-200 dark:border-accent-800 font-medium";

const hasResources =
  (project.githubs?.length ?? 0) > 0 ||
  (project.demos?.length ?? 0) > 0 ||
  (project.files?.length ?? 0) > 0;
---

<div class="animate-on-scroll" style={`animation-delay: ${animationDelay}ms`}>
  <div class="card card-hover">
    {/* Featured Badge */}
    {
      project.featured && (
        <div class="inline-flex items-center gap-2 px-3 py-1.5 rounded-full bg-accent-100 dark:bg-accent-900/30 text-accent-700 dark:text-accent-300 text-xs font-semibold border border-accent-200 dark:border-accent-800 mb-4">
          <Icon class="w-4 h-4" name="mdi:star" />
          {t("projects.featured")}
        </div>
      )
    }

    {/* Header Section */}
    <div class="pb-4 border-b border-light-border dark:border-dark-border">
      <div class="flex items-start justify-between gap-3 mb-3">
        <h3 class="text-2xl font-bold text-light-text dark:text-dark-text">
          {project.title}
        </h3>
        <span
          class="text-sm font-semibold text-light-text-muted dark:text-dark-text-muted bg-light-border/30 dark:bg-dark-border/30 px-3 py-1.5 rounded-full whitespace-nowrap"
        >
          {project.period}
        </span>
      </div>
      <p
        class="text-primary-600 dark:text-primary-400 font-semibold text-lg mb-1"
      >
        {project.role}
      </p>
      {
        project.company && (
          <p class="text-sm text-light-text-muted dark:text-dark-text-muted font-medium">
            {project.company}
          </p>
        )
      }
    </div>

    {/* Description */}
    <p
      class="text-base text-light-text-muted dark:text-dark-text-muted leading-relaxed mt-4"
    >
      {project.description}
    </p>

    {/* Achievements */}
    {
      project.achievements?.length > 0 && (
        <div class="mt-6 p-4 bg-primary-50 dark:bg-primary-900/10 rounded-lg border border-primary-200 dark:border-primary-800">
          <h4 class={sectionLabel}>
            <span class="w-1 h-4 bg-primary-500 rounded-full" />
            {t("projects.achievements")}
          </h4>
          <ul class="space-y-2 text-sm text-primary-700 dark:text-primary-300">
            {project.achievements.map((achievement: string) => (
              <li class="flex items-start gap-3">
                <span class="text-primary-500 mt-1">▸</span>
                <span class="flex-1">{achievement}</span>
              </li>
            ))}
          </ul>
        </div>
      )
    }

    {/* Responsibilities */}
    {
      project.responsibilities?.length > 0 && (
        <div class="mt-6">
          <h4 class={sectionLabel}>
            <span class="w-1 h-4 bg-accent-500 rounded-full" />
            {t("common.responsibilities")}
          </h4>
          <ul class="space-y-2 text-sm text-light-text-muted dark:text-dark-text-muted">
            {project.responsibilities.map((highlight: string) => (
              <li class="flex items-start gap-3">
                <span class="text-accent-500 mt-1">▸</span>
                <span class="flex-1">{highlight}</span>
              </li>
            ))}
          </ul>
        </div>
      )
    }

    {/* Concepts */}
    {
      project.concepts?.length > 0 && (
        <div class="mt-6">
          <h4 class={sectionLabel}>
            <span class="w-1 h-4 bg-accent-500 rounded-full" />
            {t("experience.concepts")}
          </h4>
          <div class="flex flex-wrap gap-2">
            {project.concepts.map((concept: string) => (
              <span class={conceptBadge}>{concept}</span>
            ))}
          </div>
        </div>
      )
    }

    {/* Tech Stack */}
    <div class="mt-6">
      <h4 class={sectionLabel}>
        <span class="w-1 h-4 bg-primary-500 rounded-full"></span>
        {t("common.stack")}
      </h4>
      <div class="flex flex-wrap gap-2">
        {
          project.stack.map((tech: string) => (
            <span class="badge text-xs">{tech}</span>
          ))
        }
      </div>
    </div>

    {/* Resources */}
    {
      hasResources && (
        <div class="mt-6 pt-4 border-t border-light-border dark:border-dark-border">
          <h4 class={sectionLabel}>
            <span class="w-1 h-4 bg-accent-500 rounded-full" />
            {t("common.resources")}
          </h4>

          <div class="flex flex-wrap items-center gap-3">
            {project.files?.map((file: any) => (
              <PDFButton
                filename={file.path}
                label={file.title}
                colorScheme="primary"
                variant="outline"
                size="sm"
              />
            ))}

            {project.demos?.map((demo: any) => (
              <Link
                href={demo.href}
                icon={demo.icon || "mdi:link-variant"}
                label={demo.label}
                colorScheme="primary"
                variant="outline"
                size="sm"
                ariaLabel={demo.label || t("common.demo")}
              />
            ))}

            {project.githubs?.map((github: any) => (
              <Link
                href={github.href}
                icon="mdi:github"
                label={github.label}
                colorScheme="primary"
                variant="outline"
                size="sm"
                ariaLabel={github.label || t("common.sourceCode")}
              />
            ))}
          </div>
        </div>
      )
    }
  </div>
</div>
